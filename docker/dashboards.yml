name: "Dashboards"

services:
  pgadmin:
    build: resources/pgadmin
    image: dawid0604/pcforum-pgadmin:latest
    container_name: pgadmin
    environment:
      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_EMAIL}
      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_PASSWORD}

      USER_SERVER_NAME: User Service
      USER_SERVER_HOST: user-service-postgres-db
      USER_DATABASE_NAME: ${USER_MICROSERVICE_POSTGRES_DB}
      USER_DATABASE_PORT: ${USER_MICROSERVICE_POSTGRES_PORT}
      USER_DATABASE_USER: ${USER_MICROSERVICE_POSTGRES_USER}
      USER_DATABASE_PASSWORD: ${USER_MICROSERVICE_POSTGRES_PASSWORD}

      NOTIFICATION_SERVER_NAME: Notification Service
      NOTIFICATION_SERVER_HOST: notification-service-postgres-db
      NOTIFICATION_DATABASE_NAME: ${NOTIFICATION_MICROSERVICE_POSTGRES_DB}
      NOTIFICATION_DATABASE_PORT: ${NOTIFICATION_MICROSERVICE_POSTGRES_PORT}
      NOTIFICATION_DATABASE_USER: ${NOTIFICATION_MICROSERVICE_POSTGRES_USER}
      NOTIFICATION_DATABASE_PASSWORD: ${NOTIFICATION_MICROSERVICE_POSTGRES_PASSWORD}

      THREAD_SERVER_NAME: Thread Service
      THREAD_SERVER_HOST: thread-service-postgres-db
      THREAD_DATABASE_NAME: ${THREAD_MICROSERVICE_POSTGRES_DB}
      THREAD_DATABASE_PORT: ${THREAD_MICROSERVICE_POSTGRES_PORT}
      THREAD_DATABASE_USER: ${THREAD_MICROSERVICE_POSTGRES_USER}
      THREAD_DATABASE_PASSWORD: ${THREAD_MICROSERVICE_POSTGRES_PASSWORD}

      POST_SERVER_NAME: Post Service
      POST_SERVER_HOST: post-service-postgres-db
      POST_DATABASE_NAME: ${POST_MICROSERVICE_POSTGRES_DB}
      POST_DATABASE_PORT: ${POST_MICROSERVICE_POSTGRES_PORT}
      POST_DATABASE_USER: ${POST_MICROSERVICE_POSTGRES_USER}
      POST_DATABASE_PASSWORD: ${POST_MICROSERVICE_POSTGRES_PASSWORD}

      CATEGORY_SERVER_NAME: Category Service
      CATEGORY_SERVER_HOST: category-service-postgres-db
      CATEGORY_DATABASE_NAME: ${CATEGORY_MICROSERVICE_POSTGRES_DB}
      CATEGORY_DATABASE_PORT: ${CATEGORY_MICROSERVICE_POSTGRES_PORT}
      CATEGORY_DATABASE_USER: ${CATEGORY_MICROSERVICE_POSTGRES_USER}
      CATEGORY_DATABASE_PASSWORD: ${CATEGORY_MICROSERVICE_POSTGRES_PASSWORD}

      MESSAGE_SERVER_NAME: Message Service
      MESSAGE_SERVER_HOST: message-service-postgres-db
      MESSAGE_DATABASE_NAME: ${MESSAGE_MICROSERVICE_POSTGRES_DB}
      MESSAGE_DATABASE_PORT: ${MESSAGE_MICROSERVICE_POSTGRES_PORT}
      MESSAGE_DATABASE_USER: ${MESSAGE_MICROSERVICE_POSTGRES_USER}
      MESSAGE_DATABASE_PASSWORD: ${MESSAGE_MICROSERVICE_POSTGRES_PASSWORD}

      REACTION_SERVER_NAME: Reaction Service
      REACTION_SERVER_HOST: reaction-service-postgres-db
      REACTION_DATABASE_NAME: ${REACTION_MICROSERVICE_POSTGRES_DB}
      REACTION_DATABASE_PORT: ${REACTION_MICROSERVICE_POSTGRES_PORT}
      REACTION_DATABASE_USER: ${REACTION_MICROSERVICE_POSTGRES_USER}
      REACTION_DATABASE_PASSWORD: ${REACTION_MICROSERVICE_POSTGRES_PASSWORD}

    ports:
      - "${PGADMIN_PORT}:80"

    depends_on:
      user-service-postgres-db:
        condition: service_healthy

      notification-service-postgres-db:
        condition: service_healthy

      thread-service-postgres-db:
        condition: service_healthy

      post-service-postgres-db:
        condition: service_healthy

      message-service-postgres-db:
        condition: service_healthy

      reaction-service-postgres-db:
        condition: service_healthy

    networks:
      - pcforum_network

  kafka-ui:
    image: provectuslabs/kafka-ui:v0.7.2
    container_name: kafka-ui
    environment:
      KAFKA_CLUSTERS_0_NAME: local
      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka:${INTERNAL_KAFKA_PORT}
      KAFKA_CLUSTERS_0_ZOOKEEPER: zookeeper:${ZOOKEEPER_PORT}
      AUTH_TYPE: "LOGIN_FORM"
      SPRING_SECURITY_USER_NAME: ${KAFKA_UI_USERNAME}
      SPRING_SECURITY_USER_PASSWORD: ${KAFKA_UI_PASSWORD}

    ports:
      - "${KAFKA_UI_PORT}:8080"

    depends_on:
      kafka:
        condition: service_healthy

    networks:
      - pcforum_network

networks:
  pcforum_network:
    driver: bridge
    name: pcforum_network
